---
title: "R Notebook"
output: html_notebook
---

This is a notebook presenting the plots to give insight in the various model relations. Samples of various model elements are made to verify their functioning by checking hypotheses about their expected functioning. The agents will be tested according to: 
* Functionality of individual agents at extreme values
* Correct individual behaviour
* Correct interaction between agents

This will thus be conducted for: 
Individual household behaviour; 
Household-household interaction;
Household-Food ATM interaction;

All tests will be run for 30 days and so we can define the following: 


```{r}
# till what tick
cycles_in_day <- 6*24
days_runtime<-30
until = paste0(cycles_in_day*days_runtime)
```

---

## Individual household agent

One agent instantiated, variation over `alpha` regarding the evolution of `emotional_state` over time and `gamma` regarding the evolution of `demand` over time. A Our input parameters can be defined as: 

```{r}
params = data.frame("alpha"=c(0.0,0.0,0.5),"gamma"=c(0.0,30.0,10.0))
```

The observables are:
```{r}
obs = data.frame("tick"=1,"EmotionalState"=1,"DemandedFood"=1,"FoodInStorage"=1) # for in hh testing
```

The corresponding .gaml file containing the experiment is and tailored model initialisation: 
```{r}
path = "/home/daan/GAMA/workspace/FATM_ABM/main/household_verification/household_test.gaml"
```

Therewith choosing the right experiment with one replication:
```{r}
exp_name = "Startle"
replications <- 1
```

These steps replace the introduction steps in Sampling.Rmd and so from this point on we run the part in section *Running the model*. Taken the model is run and results are saved, we can load the results from a .csv file, set the samplesize and import plotting an data filtering libraries (ggplot2 and dplyr). 

```{r}
# graphs
library(ggplot2)
# data filtering
library(dplyr);

total_df <- read.csv("/home/daan/Desktop/Verification_results/IndividualHH_Startle.csv") 

samplesize <- nrow(total_df) / (cycles_in_day*days_runtime)
```

Then we can set the theme for the plots we will be creating: 

```{r}
theme <- theme(plot.title = element_text(family = "Helvetica", size = (17.5)),
                      legend.text = element_text(face = "italic", colour="black",family = "Helvetica"), 
                      axis.title = element_text(family = "Helvetica", size = (17.5), colour = "black"),
                      axis.text=element_text())
```

Select gamma = 20.0, avg_pc=0.5 and beta = 0.1 to check the influence of alpha

```{r}
df_tmp <- total_df #filter(total_df,beta==1,avg_pc==0.5,gamma==20.0,alpha>0)
samplesize <- nrow(df_tmp) / (cycles_in_day*days_runtime)

p <- ggplot()+xlim(0,2000) +theme+ ggtitle("Emotional state, alpha=[0.1, 0.5], beta=[0.4, 1.0], gamma=[5,30]") + labs(x="ticks [10 min]",y="Emotional state [-]",colour="alpha",size=(200))
for (s in 0:(samplesize-1)) {
  until<-as.numeric(until)
  p<-p+geom_line(aes_string(x=as.numeric(df_tmp$tick[(s*until+1):((s+1)*until+1)]),y=as.numeric(df_tmp$EmotionalState[(s*until+1):((s+1)*until+1)]),color=as.numeric(df_tmp$alpha[(s*until+1):((s+1)*until+1)]))) #
}
print(p)
```


```{r}
df_tmp <- total_df #filter(total_df,beta==1,avg_pc==0.5,gamma==20.0,alpha>0)
samplesize <- nrow(df_tmp) / (cycles_in_day*days_runtime)

p <- ggplot()+xlim(0,2000) +theme+ ggtitle("Emotional state, alpha=[0.1, 0.5], beta=[0.4, 1.0], gamma=[5,30]") + labs(x="ticks [10 min]",y="Emotional state [-]",colour="alpha",size=(200))
for (s in 0:(samplesize-1)) {
  until<-as.numeric(until)
  p<-p+geom_line(aes_string(x=as.numeric(df_tmp$tick[(s*until+1):((s+1)*until+1)]),y=as.numeric(df_tmp$FoodInStorage[(s*until+1):((s+1)*until+1)]),color=as.numeric(df_tmp$alpha[(s*until+1):((s+1)*until+1)]))) #
}
print(p)
```


With the same values we see that the food in storage is also higher for higher alpha
```{r}

```

and with alpha =0.1 , avg_pc=0.5 and beta = 0.1 to check the influence of gamma

```{r}

```

Without an emotional trigger we set:

```{r}
params = data.frame("alpha"=c(0.0,0.5,0.5),"beta"=c(1.0,1.0,0.2),"gamma"=c(0.0,30.0,10.0), "avg_pc"=c(0.5,0.5,0.5)) # for ind hh testing without startle
exp_name = "NoStartle"
```

And we see

```{r}

```


## Household-household interaction

```{r}
#params = data.frame("alpha"=c(0.0,0.0,1.0),"beta"=c(1.0,1.0,0.8),"gamma"=c(5.0,5.0,1.0))
obs = data.frame("tick"=1,"AverageEmotionalState"=1)
exp_name = "NetworkStartle"

total_df <- read.csv("/home/daan/Desktop/Verification_results/Network_sampling_full.csv")
runtime <- 30*24*6
samplesize<-nrow(total_df)/runtime
```

We dont see any weird results

```{r}
# emotional state, variation with alpha, multiple replications
p <- ggplot()+xlim(0,4000) +theme+ ggtitle("Average Emotional State, full network, alpha = [0.1, 0.5], beta = [0.2, 1.0]") + labs(x="ticks [10 min]",y="Average emotional state [-]",colour="alpha",size=(200))+scale_colour_gradient(low="lightgreen",high="green4")
for (s in 0:(samplesize-1)) {
  until<-as.numeric(until)
  p<-p+geom_line(aes_string(x=as.numeric(total_df$tick[(s*until+1):((s+1)*until+1)]),y=as.numeric(total_df$AverageEmotionalState[(s*until+1):((s+1)*until+1)]),color=total_df$alpha[(s*until+1):((s+1)*until+1)])) #
}
print(p)
```

Specifically selecting a=0.5

```{r}

```

Boxplots
```{r}
# Boxplots
bplot <- ggplot() + theme + ggtitle("Avg ES, sparse network, alpha=0.1, beta=[0.2,1.0]") + labs(x="ticks [10 min]",y="Average emotional state [-]",fill="beta")
for (s in 0:20) {
  df_tmp <- filter(total_df,tick==200*s,beta==1,alpha==0.1)
  bplot<-bplot + geom_boxplot(aes_string(x = 100*s-25,  y = df_tmp$AverageEmotionalState,fill=factor(df_tmp$beta)),width=40)
}

for (s in 0:20) {
  df_tmp <- filter(total_df,tick==200*s,beta==0.2,alpha==0.1)
  bplot <- bplot +  geom_boxplot(aes_string(x = s*100+25,  y = df_tmp$AverageEmotionalState,fill=factor(df_tmp$beta)),width = 40)
}
print(bplot)
```















Add a new chunk by clicking the *Insert Chunk* button on the toolbar or by pressing *Ctrl+Alt+I*.

When you save the notebook, an HTML file containing the code and output will be saved alongside it (click the *Preview* button or press *Ctrl+Shift+K* to preview the HTML file).

The preview shows you a rendered HTML copy of the contents of the editor. Consequently, unlike *Knit*, *Preview* does not run any R code chunks. Instead, the output of the chunk when it was last run in the editor is displayed.
